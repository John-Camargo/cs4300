# Movie Theater Booking App using Django and the Django REST Framework
A lightweight movie seat-booking app built with Django and Django REST Framework (DRF).
It serves both JSON APIs and HTML pages (via DRF’s TemplateHTMLRenderer) without any user auth/sessions. Bookings store a simple name string.


# Features
- Movies, Seats, and Bookings CRUD operations (API)
- HTML Pages:
    - Movie List
    - Seat booking page per movie
    - Booking history with optional filter
- Viewsets and HTML actions for different pages
- Boostrap UI (templates)


# Project Structure
cs4300 # git repo root
|-  render.yaml # Render deployment configuration file
|-  homework2
    |-  jc_HW2 # virtual environment files
        |-  ...
    |-  movie_theater_booking # Django project directory/root
        |-  bookings # Django 'bookings' app directory
            |-  migrations # Django directory
            |-  templates # Django directory for html filoes (different pages/views)
                |-  base.html # file which has CSS styling that exists on each page
                # different views for app
                |-  movie_list.html
                |-  seat_booking.html
                |-  booking_history.html
            |-  tests # directory for testing files (unit and integration)
                |-  test_models.py # tests the models I created and ensures proper creation
                |-  test_apis.py # tests api calls and simulated api calls to ensure JSON/pages is/are returned correctly
            |-  admin.py # file which allows me to access <my_site_url>/admin/ (to do things like manually adding movies/seats)
            |-  apps.py # Django config app
            |-  models.py # Django file for creating data models (e.g. Movie, Seat, Booking)
            |-  serializers.py # Django file where I created serializers (that converted JSON API responses to HTML)
            |-  urls.py # tells the bookings app where/how to route users
            |-  views.py # where I created different ViewSets for different pages/views
        |-  movie_theater_booking # project configuration directory
            |-  Other Django Files...
            |-  settings.py # Django app config file where you modify things like installed apps and known hosts
            |-  urls.py # Django file where you configure urls for the movie_theater_booking project
        |-  db.sqlite3 # database with movie information
        |-  manage.py # management/deployment file (starts app, creates users, etc.)
        |-  requirements.txt # configuration file for Render (which details dependencies for the build)
    |-  README.md



# Use/Assistance of AI
- '__str__' definitions for each model for debugging/testing
- some conventional things in bookings/urls.py for namespacing
- how/why to use .order_by() in views.py (as it should improve test quality and consistency)
- some of the base/movie_list html code for cleanup/complete functionality
- seat_booking and booking history html files were mostly generated by ChatGPT based off of my base/movie list html(s)
- corresponding html actions in my views.py
- (most, not all of) testing files (unit testing setup and integration tests)
- some of the seetings.py configurations for deploying to Render
- the render.yaml file


# Data Models (models.py)
class Movie(models.Model):
    title = models.CharField(max_length = 40)
    description = models.TextField()
    release_date = models.DateField()
    duration = models.PositiveIntegerField()

    def __str__(self):
        return self.title

class Seat(models.Model):
    seat_number = models.PositiveIntegerField()
    booked = models.BooleanField(default = False)

    def __str__(self):
        return f"Seat {self.seat_number} - {'Booked' if self.booked else 'Available'}"

class Booking(models.Model):
    movie = models.ForeignKey(Movie, on_delete = models.CASCADE)
    seat = models.ForeignKey(Seat, on_delete = models.CASCADE)
    user = models.CharField(max_length = 50)
    booking_date = models.DateField()

    def __str__(self):
        return f"{self.user} booked {self.seat} for {self.movie}"


# Routes
All routes are generated by DRF’s router + actions:
API (JSON)
    - GET/POST /api/movies/
    - GET/POST /api/seats/
    - GET/POST /api/bookings/

HTML (TemplateHTMLRenderer)
    - GET /api/movies/ui/ → Now Playing (movie-ui)
    - GET/POST /api/movies/<id>/book/ → Seat booking for one movie (movie-book)
    - GET /api/bookings/ui/?q=<name> → Booking history (booking-ui)

Project root
    - / redirects to movie-ui


# Local Setup

1) Clone the project repo:

https://github.com/John-Camargo/cs4300.git

2) Install Dependencies

pip install -r requirements.txt

3) Configure Settings

INSTALLED_APPS = [
  ...,
  "bookings",
  "rest_framework",
]

4) Migrate

python manage.py migrate


5) Create superuser (for /admin/) 

python manage.py createsuperuser

6) Run the dev server (from the directory where manage.py lives, likely homework2/movie_theater_booking)

python manage.py runserver 0.0.0.0:3000

7) App is running! Open at http://127.0.0.1:3000/api/movies/ui/


# Running Tests
Tests live in bookings/tests/

To run all tests:

python manage.py test -v 2


# Render Deployment
Include files detailed in project setup (requirements.txt, render.yaml)

# requirements.txt (for Render Deployment)
Django==4.2.11
djangorestframework==3.15.2
gunicorn==22.0.0
whitenoise==6.6.0
psycopg2-binary==2.9.9
dj-database-url==2.2.0

# render.yaml (handles creating movie on app build as well)
services:
  - type: web
    name: movie-booking
    runtime: python
    rootDir: homework2/movie_theater_booking

    buildCommand: |
      pip install -r requirements.txt
      python manage.py collectstatic --noinput

    startCommand: |
      python manage.py migrate --noinput
      python - <<'PY'
      import os, django
      os.environ.setdefault("DJANGO_SETTINGS_MODULE", "movie_theater_booking.settings")
      django.setup()
      from django.contrib.auth import get_user_model
      from bookings.models import Seat, Movie

      # ----- Create/ensure superuser -----
      User = get_user_model()
      username = os.environ.get("DJANGO_SUPERUSER_USERNAME", "admin")
      email    = os.environ.get("DJANGO_SUPERUSER_EMAIL", "admin@example.com")
      password = os.environ.get("DJANGO_SUPERUSER_PASSWORD", "ChangeMe!123")
      u, created = User.objects.get_or_create(
          username=username,
          defaults={"email": email, "is_staff": True, "is_superuser": True},
      )
      if not created:
          u.is_staff = True
          u.is_superuser = True
          if email: u.email = email
      if password: u.set_password(password)
      u.save()
      print(f"Admin ready: {username}")

      # ----- Optional: seed seats (once) -----
      if not Seat.objects.exists():
          Seat.objects.bulk_create([Seat(seat_number=i, booked=False) for i in range(1,41)])
          print("Seeded 40 seats.")

      # ----- Optional: seed a few movies (only if none exist) -----
      if not Movie.objects.exists():
          Movie.objects.bulk_create([
              Movie(title="Inception", description="Dream heist.", release_date="2010-07-16", duration=148),
              Movie(title="Interstellar", description="Through a wormhole.", release_date="2014-11-07", duration=169),
              Movie(title="The Matrix", description="There is no spoon.", release_date="1999-03-31", duration=136),
          ])
          print("Seeded sample movies.")
      PY
      gunicorn movie_theater_booking.wsgi:application --bind 0.0.0.0:$PORT

    envVars:
      - key: PYTHON_VERSION
        value: 3.12.3
      - key: DJANGO_SETTINGS_MODULE
        value: movie_theater_booking.settings
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: "False"
      - key: ALLOWED_HOSTS
        value: ".onrender.com"
      - key: CSRF_TRUSTED_ORIGINS
        value: "https://*.onrender.com"
      - key: DATABASE_URL
        fromDatabase:
          name: movie-booking-db
          property: connectionString
      - key: DJANGO_SUPERUSER_USERNAME
        value: admin
      - key: DJANGO_SUPERUSER_EMAIL
        value: you@example.com
      - key: DJANGO_SUPERUSER_PASSWORD
        value: SWEHomework2

    plan: free
    autoDeploy: true

databases:
  - name: movie-booking-db
    plan: free


# in settings.py, change:
Host/CSRF:
    ALLOWED_HOSTS = [".onrender.com", "localhost", "127.0.0.1"]
    CSRF_TRUSTED_ORIGINS = ["https://*.onrender.com"]
    SECURE_PROXY_SSL_HEADER = ("HTTP_X_FORWARDED_PROTO", "https")
    SESSION_COOKIE_SECURE = not DEBUG
    CSRF_COOKIE_SECURE = not DEBUG

Database (use dj-database-url):
    import dj_database_url
    DATABASES = {
    "default": dj_database_url.config(
        default=f"sqlite:///{BASE_DIR / 'db.sqlite3'}",
        conn_max_age=600,
        ssl_require=False,
    )
    }

Static files (WhiteNoise):
    STATIC_URL = "/static/"
    STATIC_ROOT = BASE_DIR / "staticfiles"
    STORAGES = {
    "staticfiles": {"BACKEND": "whitenoise.storage.CompressedManifestStaticFilesStorage"}
    }
    MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "whitenoise.middleware.WhiteNoiseMiddleware",
    ...
    ]


# To add movies into app (though this is also handled by the render.yaml file on deployment)
1) Navigate to https://<service>.onrender.com/admin/

2) Siggn in using the credentials you created when setting up the project

3) Manually add movies


# Usage
    - Go to Now Playing: /api/movies/ui/
    - Click Book Now on a movie → select a seat → submit
    - View Booking History: /api/bookings/ui/?q=<name> (optional filter)
    - JSON APIs available under /api/… for programmatic access.


# (Main) Resources Used
https://docs.djangoproject.com/en/5.2/
https://www.django-rest-framework.org/
https://getbootstrap.com/docs/5.3/getting-started/introduction/
https://docs.djangoproject.com/en/5.2/topics/testing/
https://getbootstrap.com/docs/5.3/layout/grid/
https://www.w3schools.com/html/
https://www.w3schools.com/html/html_comments.asp